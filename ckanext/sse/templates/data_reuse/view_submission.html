{% extends "page.html" %}

{% block subtitle %}{{ _('View Submission') }}{% endblock %}

{% block breadcrumb_content %}
<li class="breadcrumb-item">{{ h.nav_link(_('Data Usage Submissions'), named_route='data_reuse.list_submissions') }}
</li>
<li class="breadcrumb-item active">{{ _('View Submission') }}</li>
{% endblock %}

{% block primary_content %}
{% set field_labels = h.get_data_reuse_field_labels() %}
<div class="row module-content">
  <div class="col-12">
    <div class="card-header">
      <h1 class="h4 mb-0">{{ _('Form Response') }}</h1>
      <small class="text-muted">{{ field_labels.submitted_at }}: {{ h.time_ago_from_timestamp(submission.submitted_at)
        if submission.submitted_at else _('Unknown') }}</small>
    </div>

    <div class="card-body">
      <div class="mb-4">
        <h6 class="text-primary mb-2">{{ field_labels.title }}</h6>
        <p class="mb-0">{{ submission.data.title or _('Not specified') }}</p>
      </div>

      <div class="mb-4">
        <h6 class="text-primary mb-2">{{ field_labels.dataset }}</h6>
        {% if package %}
        <a href="{{ h.url_for('dataset.read', id=package.id) }}">
          {{ package.title }}
        </a>
        {% else %}
        {{ _('No dataset') }}
        {% endif %}
      </div>

      <div class="mb-4">
        <h6 class="text-primary mb-2">{{ field_labels.full_name }}</h6>
        <p class="mb-0">{{ submission.data.full_name or _('Not specified') }}</p>
      </div>

      <div class="mb-4">
        <h6 class="text-primary mb-2">{{ field_labels.email_address }}</h6>
        <p class="mb-0">{{ submission.data.email_address or _('Not specified') }}</p>
      </div>
      <div class="mb-4">
        <h6 class="text-primary mb-2">{{ field_labels.organisation_name }}</h6>
        <p class="mb-0">{{ submission.data.organisation_name or _('Not specified') }}</p>
      </div>
      <div class="mb-4">
        <h6 class="text-primary mb-2">{{ field_labels.organisation_type }}</h6>
        <p class="mb-0">{{ submission.data.organisation_type or _('Not specified') }}</p>
      </div>
      <div class="mb-4">
        <h6 class="text-primary mb-2">{{ field_labels.label }}</h6>
        <p class="mb-0">{{ submission.data.label or _('Not specified') }}</p>
      </div>

      <div class="mb-4">
        <h6 class="text-primary mb-2">{{ field_labels.submission_type }}</h6>
        <p class="mb-0">{{ submission.data.submission_type or _('Not specified') }}</p>
      </div>

      <div class="mb-4">
        <div class="mb-4">
          <h6 class="text-primary mb-2">{{ field_labels.job_title }}</h6>
          <p class="mb-0">{{ submission.data.job_title or _('Not specified') }}</p>
        </div>

        {% if submission.data.usage_example %}
        <div class="mb-4">
          <h6 class="text-primary mb-2">{{ field_labels.usage_example }}</h6>
          <div class="p-3 bg-light rounded">{{ submission.data.usage_example }}</div>
        </div>
        {% endif %}

        {% if submission.data.usage_idea %}
        <div class="mb-4">
          <h6 class="text-primary mb-2">{{ field_labels.usage_idea }}</h6>
          <div class="p-3 bg-light rounded">{{ submission.data.usage_idea }}</div>
        </div>
        {% endif %}

        {% if submission.data.additional_information %}
        <div class="mb-4">
          <h6 class="text-primary mb-2">{{ field_labels.additional_information }}</h6>
          <div class="p-3 bg-light rounded">{{ submission.data.additional_information }}</div>
        </div>
        {% endif %}

        <div class="mb-4">
          <h6 class="text-primary mb-2">{{ field_labels.showcase_permission }}</h6>
          <p class="mb-0">
            {{ submission.data.showcase_permission or _('Not specified') }}
            {% if submission.data.showcase_permission == 'Others' and submission.data.showcase_permission_other %}
            <br><small class="text-muted mt-2 d-block">{{ submission.data.showcase_permission_other }}</small>
            {% endif %}
          </p>
        </div>

        <div class="mb-4">
          <h6 class="text-primary mb-2">{{ field_labels.contact_permission }}</h6>
          <p class="mb-0">
            {% if submission.data.contact_permission %}
            {{ _('Yes') }}
            {% else %}
            {{ _('No') }}
            {% endif %}
          </p>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="d-flex justify-content-between gap-2">
        <a href="{{ h.url_for('data_reuse.list_submissions') }}" class="btn btn-secondary">
          {{ _('Back to List') }}
        </a>

        {% if h.check_access('data_reuse_delete', {'id': submission.id}) %}
        <form method="post" action="{{ h.url_for('data_reuse.delete_submission', submission_id=submission.id) }}"
          class="delete-form">
          <a href="{{ h.url_for('data_reuse.delete_submission', submission_id=submission.id) }}" type="submit"
            class="btn btn-danger" data-module="confirm-action" data-module-content="{{ _('Are you sure?') }}">
            {{ _('Delete') }}
          </a>
        </form>
        {% endif %}
      </div>

    </div>
  </div>
</div>
{% endblock %}
{% block secondary_content %}
<aside class="module module-narrow module-shallow">
  <h2 class="module-heading">
    <i class="fa fa-info-circle"></i>
    {{ _('Help') }}
  </h2>
  <div class="module-content">
    <p class="small">{{ _('This page shows a single data usage submission. If you have questions, contact the data team.') }}</p>
  </div>
</aside>
{% endblock %}